var participants = {};
var x;

var horsesGame = (data) => {
    const HORSE_SVG_PATH = "  M1011.7,280.6l-18.1-17.3L978,245.6c0,0,0-8.4-7.2-6.7c0,0-24.4-39.6-49.7-53.1c0,0,2.1-11-9.7-7.6c0,0-20.8-15.9-29.4-12.8  c0,0-24.9-16.3-26.7-20.8c0,0-0.5,14,8.1,23.5c0,0-17.6,3.6-19,8.6c0,0-29.4,14.5-31.2,29.9c0,0,0.9,4.1-23.1,12.2  c0,0-16.3,2.3-20.4,10c0,0-9.5,2.3-12.2,5c0,0-11.8-5.4-25.3,1.8l-11.3,7.2c0,0-10-6.8-12.7-6.8c0,0,1.8-19.9,0-22.2  c0,0,0.9-15.8,0-18.1c0,0,8.5-6.5,19.9-2c0,0,1.8,8.3,8.1,5c0,0,4.9-2.6,5.2-5c0,0,4.4,0,3.6-3.9c0,0,4.4-0.8,4.4-3.1  c0,0,1.3-3.4,2.1-3.1c0,0,5.5,2.1,11.2-4.7c0,0,10.2-11.2,5.2-14.3l0.8-3.4c0,0,9.6,0.8,13.3-3.1c0,0,1.8-2.6-9.6-2.1  c0,0,3.9-41.2-32.3-44.8c0,0-11.2,0-14.3,1c0,0-5.7-1-8.6,3.1c0,0-9.9,8.1-13,16.7c0,0-5.2,0.5-3.1,3.9c0,0-21.5-1.5-30.9,1.6  c0,0-36.3-7-55.6-1.7c0,0-58.4,8.7-61.9,30.8c0,0-7.7,8.4-14.7,12.6c0,0-22.4,11-19.6,34.6c0,0,1.7,25.5,28.7,33.9  c0,0,40.2,19.9,68.1,22l-1.7,2.8c0,0-33.9-3.1-53.5,9.4c0,0-52.1-15.7-70.9-7.7c0,0-44.7,1.9-70.4-1.5c0,0-33.7-8.4-72.5,15.2  c0,0-52.7,28.2-55.2,32.9c0,0-9.7,6.3-19.4,6.3c0,0-15.6-2.1-53.1,14.7c0,0-23.6,9.3-33.3,5.9c0,0,7.2,4.6,13.5,3.8  c0,0-21.5,7.6-45.9-5.9c0,0-11.4-5.5-21.9-1.7c0,0,13.3,1.7,18.8,9.7c0,0,5.1,6.7,11,8.8c0,0-33.2,7.2-63.5-4.6  c0,0,10.5,11,34.1,11.4c0,0-5.9,7.2-39.6,5.1c0,0-19.4-3.8-37.2,23.8c0,0,19.9-20.9,36.3-20c0,0,19.4,2.5,22.3,2.1  c0,0-14.5,6.8-29.9,6.7c0,0-15.6,0-42.6,32.4c0,0-10.5,12.6-31.2,16.4c0,0,19,2.5,46.3-23.2c0,0,10.5-9.7,21.9-9.7  c0,0-44.7,39.2-74.2,38.8c0,0,19,7.6,79.6-29.5c0,0,8.4-7.2,37.9-3.4c0,0,29.1,7.2,51-1.7c0,0-9.3,8.4-25.3,8.4  c0,0,61.9,3.8,83-26.5c0,0,2.1,18.5,26.5,21.9c0,0-21.9-4.2-12.6-29.5c0,0,3.8,28.2,32.9,32c0,0-27.8-6.7-13.1-42.1  c0,0,15.6-21.5,18.1-29.5c0,0,8.8-2.9,8,3.8c0,0-11,61.9,5.9,77.1c0,0,42.6,45.1,75,49.3c0,0,12.6,13.9-6.3,44.2l-13.9,18.1  c0,0-18.5,21.9,9.7,32.9l21.5,8.4c0,0,47.2,23.6,50.1,24.4c0,0,16,12.6,17.7,17.7c0,0,7.6,11,13.5,15.2l-1.3,5.1  c0,0-5.5,2.1-7.2,4.6c0,0,2.5,30.8,12.2,39.2c0,0,19-15.2,17.3-28.6c0,0-2.1-25.7-2.9-27.4c-0.8-1.7,1.7-19.4-11-24.9l-63.2-44.2  c0,0-12.2-5.5-2.1-24.9l26.5-34.5c0,0,10.5,39.6,8,63.6c0,0-1.7,19,12.6,22.8c0,0,80.1,47.2,94,64.5c0,0,11,12.6,18.5,8l10.5,8.4  l-4.2,11c0,0,23.6,20.2,40.4,16c0,0-1.3-11-7.6-24.9l-25.3-23.6c0,0-7.6-13.1-19-18.5c0,0-65.3-44.2-72-54.8c0,0-7.6-17.7-0.8-52.2  c0,0,3.8-26.1-1.7-55.2c-2.4-12.9,27,26.5,83.6,30.2l42.8,12.8c0,0,2.9,5.5,15.2,19.8c0,0,33.7,78.4,48,83.8c0,0,1.3,7.2-13.5,7.6  l-42.1-3.8c0,0-13.5-8.8-29.5-7.6c0,0-5.1-1.7-8-5.5c0,0,0-12.2-8.4-16.9c0,0-8-8-29.9,1.7c0,0-14.7,7.6-3.4,12.2l17.3,13.9  c0,0,12.6,7.2,19,8.4l8.4,6.7c0,0,11,11.4,28.7,8.4l56.5,3.4c0,0,18.1-0.4,28.2-11.4c0,0,8.4-12.6,4.6-23.2l-7.2-20.6  c0,0-8.4-58.6-11-63.2c0,0,21.9-3.8,27.4-6.7c0,0,18.5,2.9,24,1.7c0,0,2.5,9.7,69.5,18.1c0,0,12.6,2.9,15.6,16l-0.8,11.4  c0,0-11.4,31.6-19,43.4c0,0-11.8,12.2-8,24.4l-5.1,11.8c0,0-5.5,3.8-5.5,6.7l-12.6,6.3c0,0-5.9,27,2.1,34.5c0,0,21.1-13.5,21.9-19  l9.3-18.1c0,0,6.3-15.6,8.8-16.4c0,0,5.9-6.3,8.4-19c0,0,16.9-39.6,19.4-49.3c0,0,11-15.2,6.3-28.7c0,0-3.4-15.2-12.6-20.2  l-23.6-15.6l-34.5-26.1c0,0,9.7-11,11.4-26.5c0,0,21.5-36.2,23.6-67c0,0,33.5-61.5,39.4-73.3c0,0,7.7-16.3,22.9-22v1.3  c0,0.8,1.2,1.5,2.5,1.5c1.4,0,2.5-0.7,2.5-1.5v-2.7c3-0.6,6.5-0.7,10-0.2c0,0,35.1,11.8,40.6,14.3c0,0,3.4,10.5,16.9,6.3  c0,0,10.1,3.8,11.4,3.8s2.4,6.3,13.1,7.2c0,0,2.5,16,23.2,6.3c0,0,3-1.3,2.5-5.9c0,0,7.6,11,14.3-1.3l2.1-11.4  C1011.7,303.4,1025.6,291.6,1011.7,280.6z M662.6,276.4c17.7-19.4-24.3-43.8-24.3-43.8v-1.7l12.9-5.1c1.7,5.5,22.8,46.4,22.8,46.4  L662.6,276.4z";
    const NEUTRAL_X_OFFSET = -380;
    const NEUTRAL_Y_OFFSET = -300;
    const SCALE_FACTOR = 0.1;
    const RACE_LENGTH = 500;
    const LANE_SEPARATION = 50;

    const STEP_SIZE = RACE_LENGTH / (SCALE_FACTOR * data.maxSteps);
    const MS_PER_STEP = data.msPerStep;

    // Clear canvas
    var s = Snap("#game-div");
    s.clear();

    for (let i = 0; i < data.participants.length; i++) {
        const playerName = data.participants[i];

        let initialTransform = "";//`t${NEUTRAL_X_OFFSET},${NEUTRAL_Y_OFFSET + (i * LANE_SEPARATION)}s${SCALE_FACTOR}`;
        x = s.path(HORSE_SVG_PATH).transform(initialTransform);
        participants[playerName] = { horse: x };
        console.log(participants[playerName].horse.transform());
    }

    let gameStart = (data) => {
        console.log(data);
    }

    let gameUpdate = (data) => {
        console.log(data);

        // let moveDist = STEP_SIZE * data.updateSteps;
        // console.log(moveDist);

        // participants[data.player].horse.animate({ "transform": `...t${moveDist},0` }, MS_PER_STEP);
        // console.log(participants[data.player].horse.transform())
    }

    return {
        gameStart: gameStart,
        gameUpdate: gameUpdate
    };
}